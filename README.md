# 智能家居室内定位小车与智能音箱系统

本项目实现了一套基于瑞萨RA8D1和RA6M5芯片的智能家居解决方案，主要包含两个核心功能模块：**UWB室内精确定位小车**和**智能音箱**，它们可以相互联动，提供完整的智能家居交互体验。

## 系统架构

### 硬件平台
- **瑞萨RA8D1核心控制板**：负责小车控制逻辑和传感器数据处理
- **瑞萨RA6M5芯片**：负责智能音箱的语音处理和控制
- **ESP32模块**：提供WiFi连接和云平台通信功能
- **UWB定位模块**：提供厘米级室内精确定位
- **语音识别与合成模块**：实现语音交互功能
- **步进电机驱动器**：控制小车移动
- **传感器系统**：包括温度、湿度、火焰、烟雾、光敏等传感器

### 软件系统
- **RA8D1/RA6M5固件**：处理核心控制逻辑
- **ESP32固件(tcpuart.ino)**：连接WiFi和巴法云平台
- **Python控制程序(python.py)**：提供图形界面与路径规划
- **AI助手程序(baifayun_deepseek.py)**：实现自然语言理解和智能交互
- **云平台接口**：通过巴法云平台实现设备互联

## 主要功能

### 1. UWB室内精确定位小车
- **厘米级定位精度**：基于UWB技术，提供比WiFi和蓝牙更精确的室内定位
- **自主导航**：支持设定目标位置，自动规划路径并避障
- **区域管理**：支持标记和命名区域，如客厅、卧室、厨房等
- **状态监测**：实时监测小车位置、方向和传感器数据
- **远程控制**：通过图形界面或语音指令控制小车移动

### 2. 智能音箱功能
- **语音交互**：基于讯飞语音技术，支持唤醒词识别和指令识别
- **语音控制**：通过语音指令控制家居设备（灯光、蜂鸣器等）
- **智能问答**：集成DeepSeek AI大模型，支持自然语言对话
- **环境监测**：监测室内温度、湿度、火焰、烟雾等环境参数
- **紧急预警**：异常情况自动报警提醒

### 3. 系统联动功能
- **语音指令小车**：通过智能音箱向小车发送导航指令
- **小车传感探测**：小车可在不同区域收集环境数据，反馈给智能音箱
- **智能场景联动**：如小车到达目的地后自动执行特定操作
- **安全监控联动**：检测到异常情况时，小车可前往指定区域进行查看
- **分布式传感网络**：小车作为移动传感平台，扩展智能家居感知范围

## 技术实现

### 定位与导航系统
- **UWB基站配置**：通过基站三角定位确定小车位置
- **A*路径规划算法**：考虑障碍物和墙体安全距离进行最优路径规划
- **坐标映射**：将物理坐标映射到网格坐标系统
- **动态避障**：支持实时避障和路径重规划

### 语音交互系统
- **语音识别**：支持离线和在线语音识别
- **TTS语音合成**：将文本转换为自然语音输出
- **意图识别**：通过AI模型分析用户意图，提取控制指令
- **多轮对话管理**：维护对话上下文，支持连续交互

### 智能控制系统
- **设备联网**：通过ESP32实现设备接入Internet
- **云平台通信**：使用巴法云平台实现设备互联和数据交换
- **传感器监测**：实时监测并分析各类传感器数据
- **智能响应**：根据环境变化自动执行相应操作

## 使用说明

### 硬件连接
1. 将ESP32与RA8D1/RA6M5通过UART接口连接
2. 布置UWB基站于室内不同位置，并校准坐标
3. 连接传感器模块到相应接口
4. 确保电源供应稳定

### 软件配置
1. 烧录RA8D1/RA6M5固件
2. 烧录ESP32固件(tcpuart.ino)，配置WiFi和巴法云参数
3. 运行Python控制程序(python.py)设置地图和区域
4. 运行AI助手程序(baifayun_deepseek.py)实现智能交互

### 小车控制
1. **图形界面控制**：
   - 在地图上点击位置，小车自动规划路径并导航
   - 创建、编辑和管理区域，一键导航至特定区域
   - 实时监控小车位置和传感器数据
   
2. **语音控制**：
   - 使用唤醒词"小车"激活语音识别
   - 支持的语音指令：
     - "去客厅/卧室/厨房"：导航至指定区域
     - "开灯/关灯/闪烁灯光"：控制LED
     - "打开/关闭蜂鸣器"：控制蜂鸣器
     - "查看温度/湿度"：获取环境参数

### 智能音箱使用
1. 使用唤醒词激活系统
2. 通过语音指令控制家居设备
3. 可进行自然语言对话，询问天气、新闻等信息
4. 支持设备状态查询和控制

## 项目结构
- **tcpuart.ino**：ESP32固件，负责WiFi连接和云平台通信
- **python.py**：Python图形控制界面和路径规划算法
- **baifayun_deepseek.py**：AI助手和自然语言处理
- **navigation_config.json**：存储地图、基站和区域信息
- **Basic_demo/**：基础功能演示代码
- **Advanced_demo/**：高级功能演示代码
- **AT/**：AT指令相关功能

## 开发与拓展

### 添加新功能
1. **新区域类型**：在navigation_config.json中添加新的区域定义
2. **新传感器支持**：修改ESP32固件，添加传感器读取和数据处理逻辑
3. **新AI技能**：在baifayun_deepseek.py中扩展AI助手的能力

### 调试方法
1. 使用串口监视器查看RA8D1/RA6M5和ESP32的调试输出
2. Python程序中的日志功能可记录系统运行状态
3. 通过巴法云平台监控设备实时状态

## 注意事项

1. UWB基站需要正确放置和校准才能获得准确定位
2. 语音识别在嘈杂环境中可能受到影响
3. 确保WiFi连接稳定，ESP32能够正常连接云平台
4. 使用前需校准小车电机参数，确保移动精度
5. AI功能需要网络连接，依赖DeepSeek API服务

## 故障排除

1. **小车定位不准**：
   - 检查UWB基站位置和设置
   - 重新校准基站坐标
   - 确认无大型金属物体干扰信号

2. **语音识别失败**：
   - 检查麦克风连接
   - 减少环境噪音
   - 调整麦克风增益和灵敏度

3. **系统无法联网**：
   - 检查WiFi设置
   - 确认巴法云平台密钥配置
   - 检查ESP32与RA8D1/RA6M5的通信是否正常

4. **导航异常**：
   - 检查电机驱动器连接
   - 确认地图配置和障碍物标记
   - 调整路径规划参数

## 许可证

本项目采用GPL-3.0开源许可证，详情请参阅LICENSE文件。

## 致谢

- 感谢瑞萨电子提供的RA8D1和RA6M5开发平台
- 感谢巴法云平台提供的物联网服务支持
- 感谢DeepSeek提供的AI大模型接口
- 感谢讯飞的语音合成技术
- 感谢所有为本项目做出贡献的开发者 